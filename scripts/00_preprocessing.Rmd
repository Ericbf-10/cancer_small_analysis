---
title: "Small analysis for Tiwari V. et al."
subtitle: <center> Install packages, Define paths and Data preprocessing </center>
author: "Eric Bautista Farrerons"
date: '`r paste("First created on November 2024. Updated on ", format(Sys.Date(), "%d %B %Y"))`'
output:
  html_document:
    css: style.css
    code_folding: hide
    fig_caption: yes
    toc: yes
    toc_float:
      collapsed: true
      smooth_scroll: true
    toc_depth: 4
    number_sections: true
---

```{r paths, message=FALSE, warning=FALSE}
## Install the required packages for the whole pipeline

# Check and install packages if not already installed
install_if_missing <- function(package) {
  if (!requireNamespace(package, quietly = TRUE)) {
    install.packages(package)
  }
}

# List of packages to check and install
packages <- c("here", "R.utils", "dplyr", "plyr", "dplyr", "ggplot2", "broman", "circlize", "reshape2", "gplots", "Rtsne", "png")

# Iterate over the list and install missing packages
lapply(packages, install_if_missing)

# Specific check for BiocManager and Bioconductor packages
install_if_missing_biocmanager <- function(package) {
  if (!requireNamespace(package, quietly = TRUE)) {
    BiocManager::install(package)
  }
}

if (!requireNamespace("BiocManager", quietly = TRUE)) {
  install.packages("BiocManager")
}

# List of Bioconductor packages
bioconductor_packages <- c("biomaRt", "SingleCellExperiment", "scater", "scran", "RUVSeq", "monocle", "ComplexHeatmap")

# Iterate over the list and install missing Bioconductor packages
lapply(bioconductor_packages, install_if_missing_biocmanager)

# Load all packages
all_packages <- c(packages, bioconductor_packages)

lapply(all_packages, function(pkg) {
  library(pkg, character.only = TRUE)
})
```

```{r paths, message=FALSE, warning=FALSE}
### DEFINE PATHS ###

# Find the current directory
root_path <- here::here()

# Define the current directory as the root directory
data_path <- file.path(root_path,
                       "./data")
raw_path <- file.path(data_path,
                       "./_raw")
scripts_path <- file.path(root_path,
                          "./scripts")
results_path <- file.path(root_path,
                       "./results")

# Gunzip all files in the raw data folder and place them in the data folder
gunzip_files <- function(raw_path, data_path) {
  if (!dir.exists(raw_path)) {
    stop("Raw path does not exist: ", raw_path)
  }
  if (!dir.exists(data_path)) {
    dir.create(data_path, recursive = TRUE)
  }
  
  # List all .gz files in the raw data folder
  gz_files <- list.files(raw_path, pattern = "\\.gz$", full.names = TRUE)
  
  if (length(gz_files) == 0) {
    cat("No .gz files found in", raw_path, "\n")
    return(NULL)
  }
  
  # Iterate over the files and gunzip them to the data folder
  lapply(gz_files, function(file) {
    # Determine the destination file path
    dest_file <- file.path(data_path, gsub("\\.gz$", "", basename(file)))
    cat("Unzipping:", file, "to", dest_file, "\n")
    # Decompress the file without removing the original
    R.utils::gunzip(file, destname = dest_file, overwrite = TRUE, remove = FALSE)
  })
}

gunzip_files(raw_path, data_path)
```